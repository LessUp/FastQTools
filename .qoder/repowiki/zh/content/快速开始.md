# 快速开始

<cite>
**本文档中引用的文件**  
- [README.md](file://README.md)
- [install_deps.sh](file://scripts/install_deps.sh)
- [build.sh](file://scripts/build.sh)
- [basic_stats.sh](file://examples/basic_usage/basic_stats.sh)
- [gen_fastq.py](file://tools/data/gen_fastq.py)
- [main.cpp](file://src/cli/main.cpp)
- [stat_command.cpp](file://src/cli/commands/stat_command.cpp)
- [filter_command.cpp](file://src/cli/commands/filter_command.cpp)
- [usage.md](file://docs/user/usage.md)
- [installation.md](file://docs/installation.md)
- [install_runtime.sh](file://scripts/install_runtime.sh)
</cite>

## 目录
1. [简介](#简介)
2. [安装依赖项](#安装依赖项)
3. [编译构建项目](#编译构建项目)
4. [运行基本示例](#运行基本示例)
5. [端到端完整示例](#端到端完整示例)
6. [常见问题排查](#常见问题排查)
7. [下一步](#下一步)

## 简介

本指南旨在帮助新用户在最短时间内完成 fastq-tools 项目的环境搭建并成功运行第一个命令。通过本指南，您将学习如何安装必要的依赖项、编译构建项目、运行基本示例，并理解输出结果的含义。整个过程设计为在10分钟内完成。

**Section sources**
- [README.md](file://README.md#L1-L128)

## 安装依赖项

首先，您需要安装项目所需的依赖项。项目提供了 `install_deps.sh` 脚本，可自动安装所有必要的开发和运行时依赖。

### 执行步骤

1. 打开终端，进入项目根目录：
```bash
cd /path/to/fastq-tools
```

2. 运行依赖安装脚本（推荐使用开发模式，包含所有构建所需工具）：
```bash
./scripts/install_deps.sh --dev
```

该脚本将自动执行以下操作：
- 更新包管理器列表
- 安装基础构建工具（build-essential, cmake, ninja-build）
- 安装开发库（libtbb-dev, zlib1g-dev 等）
- 安装 Clang/LLVM 19 编译器工具链
- 安装 Conan 2.19.0 包管理器
- 安装可选开发工具（gdb, valgrind, doxygen 等）

### 其他安装模式

- **仅安装运行时依赖**（适用于已构建好的二进制文件部署）：
```bash
./scripts/install_deps.sh --runtime
```

- **安装所有依赖**（开发+运行时）：
```bash
./scripts/install_deps.sh --all
```

安装完成后，脚本会自动验证安装结果并显示版本信息。

**Section sources**
- [install_deps.sh](file://scripts/install_deps.sh#L1-L282)
- [installation.md](file://docs/installation.md#L1-L169)

## 编译构建项目

依赖项安装完成后，即可使用 `build.sh` 脚本编译构建项目。

### 执行步骤

1. 在项目根目录运行构建脚本：
```bash
./scripts/build.sh
```

此命令将使用默认配置（Clang 编译器，Release 模式）构建项目。

2. 构建成功后，您将在 `build-clang-release/` 目录下找到可执行文件 `FastQTools`。

### 常用构建选项

- **指定编译器和构建类型**：
```bash
# 使用 GCC 构建 Debug 版本
./scripts/build.sh gcc Debug

# 使用 Clang 构建 Release 版本（默认）
./scripts/build.sh clang Release
```

- **启用调试工具**：
```bash
# 启用 AddressSanitizer 和 UndefinedBehaviorSanitizer
./scripts/build.sh clang Debug --asan --usan

# 启用 ThreadSanitizer
./scripts/build.sh clang Debug --tsan
```

构建脚本会自动处理 Conan 依赖解析、CMake 配置和 Ninja 编译过程。

**Section sources**
- [build.sh](file://scripts/build.sh#L1-L319)
- [README.md](file://README.md#L87-L108)

## 运行基本示例

现在您已经成功构建了项目，可以运行一个基本示例来验证安装是否正确。

### 执行步骤

1. 准备测试数据：
```bash
# 使用工具生成测试 FASTQ 文件
python3 tools/data/gen_fastq.py -o test_data.fastq --reads 5000 --min-len 80 --max-len 150
```

2. 运行基本统计示例：
```bash
# 运行预置的统计分析脚本
./examples/basic_usage/basic_stats.sh test_data.fastq
```

### 输出结果解释

脚本执行后将显示以下信息：

- **输入文件信息**：文件大小、压缩格式等
- **处理参数**：线程数、批处理大小等
- **执行摘要**：处理耗时、结果文件位置
- **结果摘要**：总读取数、总碱基数、平均读长、GC含量、Q30碱基等关键指标

最终结果将保存在 `results/` 目录下的 `.stat.txt` 文件中，并可选择生成 HTML 报告。

**Section sources**
- [basic_stats.sh](file://examples/basic_usage/basic_stats.sh#L1-L226)
- [gen_fastq.py](file://tools/data/gen_fastq.py#L1-L51)
- [examples/basic_usage/README.md](file://examples/basic_usage/README.md#L1-L79)

## 端到端完整示例

以下是一个完整的端到端使用示例，从数据准备到统计分析再到过滤处理。

### 1. 准备 FASTQ 文件

```bash
# 生成 10,000 条 reads 的测试数据
python3 tools/data/gen_fastq.py -o sample.fastq --reads 10000 --seed 42
```

### 2. 执行统计分析

```bash
# 获取基础统计信息
./build-clang-release/FastQTools stat -i sample.fastq -o sample.stat.txt --threads 4
```

**stat 命令参数说明**：
- `-i`: 输入 FASTQ 文件路径
- `-o`: 输出统计文件路径
- `--threads`: 使用的线程数
- `--batch-size`: 每批处理的 reads 数量

### 3. 执行过滤处理

```bash
# 应用简单过滤规则
./build-clang-release/FastQTools filter -i sample.fastq -o filtered.fastq \
  --min-quality 20 \
  --min-length 50 \
  --max-n-ratio 0.1 \
  --trim-quality 20 \
  --trim-mode both
```

**filter 命令参数说明**：
- `--min-quality`: 最小平均质量阈值
- `--min-length`: 最小读长
- `--max-n-ratio`: 最大 N 碱基比例
- `--trim-quality`: 质量修剪阈值
- `--trim-mode`: 修剪模式（both, five, three）

这些命令与 `src/cli/main.cpp` 中定义的 CLI 语法完全一致，确保了命令行接口的准确性和一致性。

**Section sources**
- [main.cpp](file://src/cli/main.cpp#L1-L138)
- [stat_command.cpp](file://src/cli/commands/stat_command.cpp#L1-L78)
- [filter_command.cpp](file://src/cli/commands/filter_command.cpp#L1-L165)
- [usage.md](file://docs/user/usage.md#L1-L87)

## 常见问题排查

在初次使用过程中，可能会遇到一些常见问题。以下是快速排查建议：

### 依赖缺失

**症状**：`install_deps.sh` 脚本执行失败，提示找不到包。

**解决方案**：
- 确保系统为 Ubuntu/Debian 系列
- 手动更新包列表：`sudo apt-get update`
- 检查网络连接和软件源配置

### 编译错误

**症状**：`build.sh` 脚本执行失败，提示 Conan 或 CMake 错误。

**解决方案**：
- 确认已成功安装 Conan：`conan --version`
- 确认已成功安装 CMake：`cmake --version`
- 检查编译器是否可用：`clang++ --version`
- 确保项目根目录有足够磁盘空间

### 可执行文件未找到

**症状**：构建成功但找不到 `FastQTools` 可执行文件。

**解决方案**：
- 检查构建目录：`ls build-clang-release/`
- 确认构建脚本是否成功完成
- 检查是否有权限问题

### 运行时错误

**症状**：运行 `FastQTools` 时出现段错误或缺少共享库。

**解决方案**：
- 确保已安装运行时依赖：`./scripts/install_runtime.sh`
- 检查缺少的库：`ldd build-clang-release/FastQTools`
- 确认 libtbb12 等关键库已安装

**Section sources**
- [install_deps.sh](file://scripts/install_deps.sh#L197-L206)
- [build.sh](file://scripts/build.sh#L156-L177)
- [installation.md](file://docs/installation.md#L137-L145)

## 下一步

恭喜！您已经成功完成了 fastq-tools 的快速入门。接下来，您可以：

1. **探索更多示例**：查看 `examples/` 目录下的其他使用示例
2. **深入学习**：阅读 [使用指南](docs/user/usage.md) 了解更高级的功能
3. **性能测试**：使用 `tools/benchmark/` 目录下的基准测试工具
4. **开发贡献**：参考 [开发指南](docs/dev/) 参与项目开发

通过本指南，您已经掌握了 fastq-tools 的基本使用方法，可以开始处理真实的 FASTQ 数据了。

**Section sources**
- [README.md](file://README.md#L110-L123)
- [docs/user/usage.md](file://docs/user/usage.md#L1-L87)